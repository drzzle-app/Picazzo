"use strict";!function(e){e.fn.drzAudioPlayer=function(){var o=e(document),d=e(this),i=d.attr("data-player-id"),r=d.attr("data-episodes"),n=window.localStorage.getItem("drzzleStorage"),t=n?JSON.parse(n):{};return t.audioPlayer=t.audioPlayer||{},d.each(function(){var n=e(this),a=n.find(".drzAudio-src"),s=a.get(0),u=n.find(".drzAudio-titleContainer"),l=n.find(".playBtnContainer"),c=n.find(".drzAudio-playBtn"),f=n.find(".drzAudio-pauseBtn"),p=n.find(".drzAudio-volumeBtn"),g=n.find(".drzAudio-volumeContainer"),v=n.find(".drzAudio-volumeSliderContainer"),A=n.find(".drzAudio-volSlider"),m=n.find(".drzAudio-muteBtn"),z=n.find(".drzAudio-progress"),h=n.find(".drzAudio-progressBar"),y=n.find(".drzAudio-currentTime"),w=n.find(".drzAudio-totalTime"),P=a.find("source"),C=P.attr("src"),B=!1;y.html("0:00"),n.find(".drzAudio-src").load();var L={onDurationChange:function(){var e=parseInt(s.duration/60,10),o=parseInt(e/60,10),d=parseInt(s.duration%60,10);d=d<10?":0"+d:":"+d,o>0?o+=":":o="",w.html(o+e+d)},onTimeUpdate:function(){var e=parseInt(s.currentTime/60,10),o=parseInt(s.currentTime%60,10),d=parseInt(e/60,10),r=parseInt(s.currentTime.toFixed(0),10),n=parseInt(t.audioPlayer[i].seconds,10);0!==r&&r!==n&&(t.audioPlayer[i].seconds=r,window.localStorage.setItem("drzzleStorage",JSON.stringify(t)));var a=0;s.currentTime>0&&(a=Math.floor(100/s.duration*s.currentTime)),o=o<10?":0"+o:":"+o,d>0?d+=":":d="",z.css("width",(99===a?a+1:a)+"%"),y.html(d+e+o)},updateProgress:function(e){var o=s.duration,d=(e-h.offset().left)/h.width()*100;d>100&&(d=100),d<0&&(d=0),s.currentTime=o*(d/100),z.css("width",d+"%")},progressDrag:!1,playAudio:function(){(s.paused||s.ended)&&s.play()},pauseAudio:function(){s.pause()},setVolume:function(){s.volume=A.val()},toggleMute:function(){s.muted=!s.muted,m.toggleClass("drzAudio-muteOff")},togglePlay:function(){c.hasClass("drzAudio-pauseBtn")?L.pauseAudio():L.playAudio()},onPlay:function(){c.addClass("drzAudio-pauseBtn"),c.removeClass("drzAudio-replayBtn");var e=a.find("source").attr("src");(t.audioPlayer[i].source=e,r)&&L.$listContainer.find(".drzAudio-episodes-livebtn").parent().addClass("drzAudio-playing")},onEnd:function(){if(c.removeClass("drzAudio-pauseBtn"),c.addClass("drzAudio-replayBtn"),r){var e=P.attr("src");L.$listContainer.find('[data-audio-src="'+e+'"]').find(".drzAudio-episodes-rcol").removeClass("drzAudio-playing")}},onPause:function(){if(c.removeClass("drzAudio-pauseBtn"),c.removeClass("drzAudio-replayBtn"),r){var e=P.attr("src");L.$listContainer.find('[data-audio-src="'+e+'"]').find(".drzAudio-episodes-rcol").removeClass("drzAudio-playing")}},setLoading:function(e){e?(B=!0,c.hide(),f.hide(),L.$loader.show()):(B=!1,c.show(),f.show(),L.$loader.hide())},hideVolume:function(){v.fadeOut("fast")},toggleVolume:function(){v.fadeToggle("fast")},$listContainer:null,showPlaying:function(){var o=P.attr("src");L.$listContainer.find("[data-audio-src]").each(function(){var d=e(this);d.find(".drzAudio-episodes-rcol").removeClass("drzAudio-playing");var i=d.find(".drzAudio-episodes-plbtn");d.attr("data-audio-src")===o?i.addClass("drzAudio-episodes-livebtn"):i.removeClass("drzAudio-episodes-livebtn")})},onClickTrack:function(o){if(o.preventDefault(),!B){L.setLoading(!0),d.drzAudioPlayer.destroy(d,"play"),delete t.audioPlayer[i],window.localStorage.setItem("drzzleStorage",JSON.stringify(t));var r=e(o.target).closest("[data-audio-src]"),n=r.attr("data-audio-src"),a=r.find(".drzAudio-episodes-title").text();P.attr("src",n),new Audio(n).onloadeddata=function(){d.drzAudioPlayer(),u.text(a),L.showPlaying(),L.togglePlay(),L.setLoading(!1)}}},buildEpisodes:function(){var o=JSON.parse(r).list,i=d.next(".drzAudio-episodes-container");if(i.length)L.$listContainer=i;else{var n=e('<div class="drzAudio-episodes-container"></div>');o.forEach(function(o){var i=e('<a class="drzAudio-episodes-item" data-audio-src="'+o.source+'" href="#">\n                  <div class="drzAudio-episodes-data">\n                    <span class="drzAudio-episodes-title">'+o.title+'</span>\n                    <span class="drzAudio-episodes-date">Published - '+o.published+'</span>\n                  </div>\n                  <div class="drzAudio-episodes-rcol">\n                    <svg class="drzAudio-episodes-eq" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">\n                      <rect class="drzAudio-episodes-eqbar drzAudio-eq-bar1" x="4" y="4" width="3.7" height="8"/>\n                      <rect class="drzAudio-episodes-eqbar drzAudio-eq-bar2" x="10.2" y="4" width="3.7" height="16"/>\n                      <rect class="drzAudio-episodes-eqbar drzAudio-eq-bar3" x="16.3" y="4" width="3.7" height="11"/>\n                    </svg>\n                    <span class="drzAudio-episodes-plbtn"></span>\n                  </div>\n                </a>');i.click(L.onClickTrack),n.append(i),n.insertAfter(d)}),L.$listContainer=n}},onProgressPress:function(e){L.progressDrag=!0,L.updateProgress(e.pageX)},onMouseUp:function(e){L.progressDrag&&(L.progressDrag=!1,L.updateProgress(e.pageX))},onMouseMove:function(e){L.progressDrag&&L.updateProgress(e.pageX)},$loader:null,createLoader:function(){var o=l.find(".drzAudio-loader");if(o.length)L.$loader=o;else{var d=e('\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38 38" class="drzAudio-loader">\n                <g fill="none" fill-rule="evenodd">\n                  <g transform="translate(1 1)" stroke-width="2">\n                    <circle stroke-opacity=".5" cx="18" cy="18" r="18"/>\n                    <path d="M36 18c0-9.94-8.06-18-18-18" transform="rotate(356.81 18.0001 18.0001)">\n                      <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"/>\n                    </path>\n                  </g>\n                </g>\n              </svg>\n            ');d.insertBefore(c),L.$loader=d}}};L.createLoader();var k=t.audioPlayer[i];if(k){if(!r&&k.source===C)L.setLoading(!0),new Audio(k.source).onloadeddata=function(){s.currentTime=k.seconds,L.setLoading(!1)};if(r){var T=JSON.parse(r).list;if(T.map(function(e){return e.source}).includes(k.source))L.setLoading(!0),P.attr("src",k.source),new Audio(k.source).onloadeddata=function(){s.currentTime=k.seconds;var e=T.find(function(e){return e.source===k.source});u.text(e.title),L.setLoading(!1)}}}else t.audioPlayer[i]={source:null,seconds:0};s.addEventListener("durationchange",L.onDurationChange,!1),s.addEventListener("timeupdate",L.onTimeUpdate,!1),s.addEventListener("play",L.onPlay,!1),s.addEventListener("ended",L.onEnd,!1),s.addEventListener("pause",L.onPause,!1),n.click(L.hideVolume),c.click(L.togglePlay),p.click(L.toggleVolume),f.click(L.pauseAudio),g.click(function(e){e.stopPropagation()}),A.change(L.setVolume),m.click(L.toggleMute),h.on("vmousedown",L.onProgressPress),o.on("vmouseup",L.onMouseUp),o.on("vmousemove",L.onMouseMove),r&&(L.buildEpisodes(),L.showPlaying()),e.fn.drzAudioPlayer.destroy=function(e,d){e.find(".drzAudio-playBtn").off("click").removeClass("drzAudio-pauseBtn drzAudio-replayBtn"),e.find(".drzAudio-pauseBtn").off("click"),e.find(".drzAudio-volSlider").off("change"),e.find(".drzAudio-muteBtn").off("click"),e.find(".drzAudio-progressBar").off("vmousedown"),e.find(".drzAudio-volumeBtn").off("click"),o.off("vmouseup",L.onMouseUp),o.off("vmousemove",L.onMouseMove),n.off("click"),window.__editor&&!d&&e.next(".drzAudio-episodes-container").remove();var i=e.find(".drzAudio-src").get(0);i.removeEventListener("durationchange",L.onDurationChange,!1),i.removeEventListener("timeupdate",L.onTimeUpdate,!1),i.removeEventListener("play",L.onPlay,!1),i.removeEventListener("ended",L.onEnd,!1),i.removeEventListener("pause",L.onPause,!1)}}),this}}(jQuery);