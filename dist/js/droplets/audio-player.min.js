"use strict";!function(e){e.fn.drzAudioPlayer=function(){var o=e(document),i=e(this),d=i.attr("data-player-id"),r=i.attr("data-episodes"),n=window.localStorage.getItem("drzzleStorage"),t=n?JSON.parse(n):{};return t.audioPlayer=t.audioPlayer||{},i.each(function(){var n=e(this),a=n.find(".drzAudio-src"),s=a.get(0),u=n.find(".drzAudio-titleContainer"),l=n.find(".drzAudio-playBtnContainer"),c=n.find(".drzAudio-playBtn"),f=n.find(".drzAudio-pauseBtn"),p=n.find(".drzAudio-volumeBtn"),g=n.find(".drzAudio-volumeContainer"),v=n.find(".drzAudio-volumeSliderContainer"),A=n.find(".drzAudio-volSlider"),m=n.find(".drzAudio-muteBtn"),z=n.find(".drzAudio-progress"),h=n.find(".drzAudio-progressBar"),y=n.find(".drzAudio-currentTime"),w=n.find(".drzAudio-totalTime"),P=a.find("source"),C=P.attr("src"),B=!1;y.html("0:00"),n.find(".drzAudio-src").load();var k={onDurationChange:function(){var e=parseInt(s.duration/60,10),o=parseInt(e/60,10),i=parseInt(s.duration%60,10);i=i<10?":0"+i:":"+i,o>0?o+=":":o="",w.html(o+e+i)},onTimeUpdate:function(){var e=parseInt(s.currentTime/60,10),o=parseInt(s.currentTime%60,10),i=parseInt(e/60,10),r=parseInt(s.currentTime.toFixed(0),10),n=parseInt(t.audioPlayer[d].seconds,10);0!==r&&r!==n&&(t.audioPlayer[d].seconds=r,window.localStorage.setItem("drzzleStorage",JSON.stringify(t)));var a=0;s.currentTime>0&&(a=Math.floor(100/s.duration*s.currentTime)),o=o<10?":0"+o:":"+o,i>0?i+=":":i="",z.css("width",(99===a?a+1:a)+"%"),y.html(i+e+o)},updateProgress:function(e){var o=s.duration,i=(e-h.offset().left)/h.width()*100;i>100&&(i=100),i<0&&(i=0),s.currentTime=o*(i/100),z.css("width",i+"%")},progressDrag:!1,playAudio:function(){(s.paused||s.ended)&&s.play()},pauseAudio:function(){s.pause()},setVolume:function(){s.volume=A.val()},toggleMute:function(){s.muted=!s.muted,m.toggleClass("drzAudio-muteOff")},togglePlay:function(){c.hasClass("drzAudio-pauseBtn")?k.pauseAudio():k.playAudio()},onPlay:function(){c.addClass("drzAudio-pauseBtn"),c.removeClass("drzAudio-replayBtn");var e=a.find("source").attr("src");(t.audioPlayer[d].source=e,r)&&k.$listContainer.find(".drzAudio-episodes-livebtn").parent().addClass("drzAudio-playing")},onEnd:function(){if(c.removeClass("drzAudio-pauseBtn"),c.addClass("drzAudio-replayBtn"),r){var e=P.attr("src");k.$listContainer.find('[data-audio-src="'+e+'"]').find(".drzAudio-episodes-rcol").removeClass("drzAudio-playing")}},onPause:function(){if(c.removeClass("drzAudio-pauseBtn"),c.removeClass("drzAudio-replayBtn"),r){var e=P.attr("src");k.$listContainer.find('[data-audio-src="'+e+'"]').find(".drzAudio-episodes-rcol").removeClass("drzAudio-playing")}},setLoading:function(e){e?(B=!0,c.hide(),f.hide(),k.$loader.show()):(B=!1,c.show(),f.show(),k.$loader.hide())},hideVolume:function(){v.fadeOut("fast")},toggleVolume:function(){v.fadeToggle("fast")},$listContainer:null,showPlaying:function(){var o=P.attr("src");k.$listContainer.find("[data-audio-src]").each(function(){var i=e(this);i.find(".drzAudio-episodes-rcol").removeClass("drzAudio-playing");var d=i.find(".drzAudio-episodes-plbtn");i.attr("data-audio-src")===o?d.addClass("drzAudio-episodes-livebtn"):d.removeClass("drzAudio-episodes-livebtn")})},onClickTrack:function(o){if(o.preventDefault(),!B){k.setLoading(!0),i.drzAudioPlayer.destroy(i,"play"),delete t.audioPlayer[d],window.localStorage.setItem("drzzleStorage",JSON.stringify(t));var r=e(o.target).closest("[data-audio-src]"),n=r.attr("data-audio-src"),a=r.find(".drzAudio-episodes-title").text();P.attr("src",n);var s=new Audio(n);k.isIOS()&&(s.autoplay=!0),s.onloadeddata=function(){i.drzAudioPlayer(),u.text(a),k.showPlaying(),c.trigger("click"),k.setLoading(!1)}}},buildEpisodes:function(){var o=JSON.parse(r).list,d=i.next(".drzAudio-episodes-container");if(d.length)k.$listContainer=d;else{var n=e('<div class="drzAudio-episodes-container"></div>');o.forEach(function(o){var d=e('<a class="drzAudio-episodes-item" data-audio-src="'+o.source+'" href="#">\n                  <div class="drzAudio-episodes-data">\n                    <span class="drzAudio-episodes-title">'+o.title+'</span>\n                    <span class="drzAudio-episodes-date">Published - '+o.published+'</span>\n                  </div>\n                  <div class="drzAudio-episodes-rcol">\n                    <svg class="drzAudio-episodes-eq" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">\n                      <rect class="drzAudio-episodes-eqbar drzAudio-eq-bar1" x="4" y="4" width="3.7" height="8"/>\n                      <rect class="drzAudio-episodes-eqbar drzAudio-eq-bar2" x="10.2" y="4" width="3.7" height="16"/>\n                      <rect class="drzAudio-episodes-eqbar drzAudio-eq-bar3" x="16.3" y="4" width="3.7" height="11"/>\n                    </svg>\n                    <span class="drzAudio-episodes-plbtn"></span>\n                  </div>\n                </a>');d.click(k.onClickTrack),n.append(d),n.insertAfter(i)}),k.$listContainer=n}},onProgressPress:function(e){k.progressDrag=!0,k.updateProgress(e.pageX)},onMouseUp:function(e){k.progressDrag&&(k.progressDrag=!1,k.updateProgress(e.pageX))},onMouseMove:function(e){k.progressDrag&&k.updateProgress(e.pageX)},$loader:null,createLoader:function(){var o=l.find(".drzAudio-loader");if(o.length)k.$loader=o;else{var i=e('\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38 38" class="drzAudio-loader">\n                <g fill="none" fill-rule="evenodd">\n                  <g transform="translate(1 1)" stroke-width="2">\n                    <circle stroke-opacity=".5" cx="18" cy="18" r="18"/>\n                    <path d="M36 18c0-9.94-8.06-18-18-18" transform="rotate(356.81 18.0001 18.0001)">\n                      <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"/>\n                    </path>\n                  </g>\n                </g>\n              </svg>\n            ');i.insertBefore(c),k.$loader=i}},isIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)}};k.createLoader();var L=t.audioPlayer[d];if(L){if(!r&&L.source===C){k.setLoading(!0);var S=new Audio(L.source);k.isIOS()&&(S.autoplay=!0),S.onloadeddata=function(){s.currentTime=L.seconds,k.setLoading(!1)}}if(r){var T=JSON.parse(r).list;if(T.map(function(e){return e.source}).includes(L.source)){k.setLoading(!0),P.attr("src",L.source);var b=new Audio(L.source);k.isIOS()&&(b.autoplay=!0),b.onloadeddata=function(){s.currentTime=L.seconds;var e=T.find(function(e){return e.source===L.source});u.text(e.title),k.setLoading(!1)}}}}else t.audioPlayer[d]={source:null,seconds:0},k.isIOS()&&(s.autoplay=!0);s.addEventListener("durationchange",k.onDurationChange,!1),s.addEventListener("timeupdate",k.onTimeUpdate,!1),s.addEventListener("play",k.onPlay,!1),s.addEventListener("ended",k.onEnd,!1),s.addEventListener("pause",k.onPause,!1),n.click(k.hideVolume),c.click(k.togglePlay),p.click(k.toggleVolume),f.click(k.pauseAudio),g.click(function(e){e.stopPropagation()}),A.change(k.setVolume),m.click(k.toggleMute),h.on("vmousedown",k.onProgressPress),o.on("vmouseup",k.onMouseUp),o.on("vmousemove",k.onMouseMove),r&&(k.buildEpisodes(),k.showPlaying()),e.fn.drzAudioPlayer.destroy=function(e,i){e.find(".drzAudio-playBtn").off("click").removeClass("drzAudio-pauseBtn drzAudio-replayBtn"),e.find(".drzAudio-pauseBtn").off("click"),e.find(".drzAudio-volSlider").off("change"),e.find(".drzAudio-muteBtn").off("click"),e.find(".drzAudio-progressBar").off("vmousedown"),e.find(".drzAudio-volumeBtn").off("click"),o.off("vmouseup",k.onMouseUp),o.off("vmousemove",k.onMouseMove),n.off("click"),window.__editor&&!i&&e.next(".drzAudio-episodes-container").remove();var d=e.find(".drzAudio-src").get(0);d.removeEventListener("durationchange",k.onDurationChange,!1),d.removeEventListener("timeupdate",k.onTimeUpdate,!1),d.removeEventListener("play",k.onPlay,!1),d.removeEventListener("ended",k.onEnd,!1),d.removeEventListener("pause",k.onPause,!1)}}),this}}(jQuery);