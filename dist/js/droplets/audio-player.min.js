"use strict";!function(e){e.fn.drzAudioPlayer=function(){var o=e(document),r=e(this),i=r.attr("data-player-id"),n=r.attr("data-episodes"),d=window.localStorage.getItem("drzzleStorage"),a=d?JSON.parse(d):{};return a.audioPlayer=a.audioPlayer||{},r.each(function(){var d=e(this),t=d.find(".drzAudio-src"),s=t.get(0),u=d.find(".drzAudio-titleContainer"),l=d.find(".drzAudio-error"),c=d.find(".drzAudio-playBtnContainer"),f=d.find(".drzAudio-playBtn"),p=d.find(".drzAudio-pauseBtn"),g=d.find(".drzAudio-volumeBtn"),v=d.find(".drzAudio-volumeContainer"),m=d.find(".drzAudio-volumeSliderContainer"),A=d.find(".drzAudio-volSlider"),z=d.find(".drzAudio-muteBtn"),y=d.find(".drzAudio-progress"),h=d.find(".drzAudio-progressBar"),P=d.find(".drzAudio-currentTime"),w=d.find(".drzAudio-totalTime"),C=t.find("source"),B=C.attr("src"),L=!1;P.html("0:00"),d.find(".drzAudio-src").load();var E={onDurationChange:function(){var e=parseInt(s.duration/60,10),o=parseInt(e/60,10),r=parseInt(s.duration%60,10);r=r<10?":0"+r:":"+r,o>0?o+=":":o="",w.html(o+e+r)},onTimeUpdate:function(){var e=parseInt(s.currentTime/60,10),o=parseInt(s.currentTime%60,10),r=parseInt(e/60,10),n=parseInt(s.currentTime.toFixed(0),10),d=parseInt(a.audioPlayer[i].seconds,10);0!==n&&n!==d&&(a.audioPlayer[i].seconds=n,window.localStorage.setItem("drzzleStorage",JSON.stringify(a)));var t=0;s.currentTime>0&&(t=Math.floor(100/s.duration*s.currentTime)),o=o<10?":0"+o:":"+o,r>0?r+=":":r="",y.css("width",(99===t?t+1:t)+"%"),P.html(r+e+o)},updateProgress:function(e){var o=s.duration,r=(e-h.offset().left)/h.width()*100;r>100&&(r=100),r<0&&(r=0),s.currentTime=o*(r/100),y.css("width",r+"%")},progressDrag:!1,playAudio:function(){(s.paused||s.ended)&&s.play()},pauseAudio:function(){s.pause()},setVolume:function(){s.volume=A.val()},toggleMute:function(){s.muted=!s.muted,z.toggleClass("drzAudio-muteOff")},togglePlay:function(){f.hasClass("drzAudio-pauseBtn")?E.pauseAudio():E.playAudio()},isPlaying:!1,onPlay:function(){E.isPlaying=!0,f.addClass("drzAudio-pauseBtn"),f.removeClass("drzAudio-replayBtn");var e=t.find("source").attr("src");(a.audioPlayer[i].source=e,n)&&E.$listContainer.find(".drzAudio-episodes-livebtn").parent().addClass("drzAudio-playing")},onEnd:function(){if(E.isPlaying=!1,f.removeClass("drzAudio-pauseBtn"),f.addClass("drzAudio-replayBtn"),n){var e=C.attr("src");E.$listContainer.find('[data-audio-src="'+e+'"]').find(".drzAudio-episodes-rcol").removeClass("drzAudio-playing")}},onPause:function(){if(E.isPlaying=!1,f.removeClass("drzAudio-pauseBtn"),f.removeClass("drzAudio-replayBtn"),n){var e=C.attr("src");E.$listContainer.find('[data-audio-src="'+e+'"]').find(".drzAudio-episodes-rcol").removeClass("drzAudio-playing")}},setLoading:function(e){e?(L=!0,f.hide(),p.hide(),E.$loader.show()):(L=!1,f.show(),p.show(),E.$loader.hide())},hideVolume:function(){m.fadeOut("fast")},toggleVolume:function(){m.fadeToggle("fast")},$listContainer:null,showPlaying:function(){var o=C.attr("src");E.$listContainer.find("[data-audio-src]").each(function(){var r=e(this);r.find(".drzAudio-episodes-rcol").removeClass("drzAudio-playing");var i=r.find(".drzAudio-episodes-plbtn");r.attr("data-audio-src")===o?i.addClass("drzAudio-episodes-livebtn"):i.removeClass("drzAudio-episodes-livebtn")})},onClickTrack:function(o){if(o.preventDefault(),!L){E.setLoading(!0);var n=e(o.target).closest("[data-audio-src]"),d=n.attr("data-audio-src");r.drzAudioPlayer.destroy(r,"play"),E.isPlaying&&(s.pause(),s.currentTime=0),a.audioPlayer[i].source=d,a.audioPlayer[i].seconds=0,window.localStorage.setItem("drzzleStorage",JSON.stringify(a));var t=n.find(".drzAudio-episodes-title").text();C.attr("src",d);var l=new Audio(d);E.isIOS()&&(l.autoplay=!0),l.onerror=function(){u.text(t),E.showPlaying(),E.onError()},l.onloadeddata=function(){l.pause(),l.remove(),r.drzAudioPlayer(),u.text(t),E.showPlaying(),f.trigger("click"),E.onLoad()}}},buildEpisodes:function(){var o=JSON.parse(n).list,i=r.next(".drzAudio-episodes-container");if(i.length)E.$listContainer=i;else{var d=e('<div class="drzAudio-episodes-container"></div>');o.forEach(function(o){var i=e('<a class="drzAudio-episodes-item" data-audio-src="'+o.source+'" href="#">\n                  <div class="drzAudio-episodes-data">\n                    <span class="drzAudio-episodes-title">'+o.title+'</span>\n                    <span class="drzAudio-episodes-date">Published - '+o.published+'</span>\n                  </div>\n                  <div class="drzAudio-episodes-rcol">\n                    <svg class="drzAudio-episodes-eq" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">\n                      <rect class="drzAudio-episodes-eqbar drzAudio-eq-bar1" x="4" y="4" width="3.7" height="8"/>\n                      <rect class="drzAudio-episodes-eqbar drzAudio-eq-bar2" x="10.2" y="4" width="3.7" height="16"/>\n                      <rect class="drzAudio-episodes-eqbar drzAudio-eq-bar3" x="16.3" y="4" width="3.7" height="11"/>\n                    </svg>\n                    <span class="drzAudio-episodes-plbtn"></span>\n                  </div>\n                </a>');i.click(E.onClickTrack),d.append(i),d.insertAfter(r)}),E.$listContainer=d}},onProgressPress:function(e){E.progressDrag=!0,E.updateProgress(e.pageX)},onMouseUp:function(e){E.progressDrag&&(E.progressDrag=!1,E.updateProgress(e.pageX))},onMouseMove:function(e){E.progressDrag&&E.updateProgress(e.pageX)},onLoad:function(){l.hide(),E.setLoading(!1)},onError:function(){l.show(),s.currentTime=0,E.setLoading(!1)},$loader:null,createLoader:function(){var o=c.find(".drzAudio-loader");if(o.length)E.$loader=o;else{var r=e('\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38 38" class="drzAudio-loader">\n                <g fill="none" fill-rule="evenodd">\n                  <g transform="translate(1 1)" stroke-width="2">\n                    <circle stroke-opacity=".5" cx="18" cy="18" r="18"/>\n                    <path d="M36 18c0-9.94-8.06-18-18-18" transform="rotate(356.81 18.0001 18.0001)">\n                      <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"/>\n                    </path>\n                  </g>\n                </g>\n              </svg>\n            ');r.insertBefore(f),E.$loader=r}},isIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)}};E.createLoader();var k=a.audioPlayer[i];if(k){if(!n&&k.source===B){E.setLoading(!0);var S=new Audio(k.source);E.isIOS()&&(S.autoplay=!0),S.onerror=E.onError(),S.onloadeddata=function(){S.pause(),S.remove(),s.currentTime=k.seconds,E.onLoad()}}if(n){var T=JSON.parse(n).list;if(T.map(function(e){return e.source}).includes(k.source)){E.setLoading(!0),C.attr("src",k.source);var b=new Audio(k.source);E.isIOS()&&(b.autoplay=!0),b.onerror=function(){var e=T.find(function(e){return e.source===k.source});u.text(e.title),E.showPlaying(),E.onError()},b.onloadeddata=function(){b.pause(),b.remove(),s.currentTime=k.seconds;var e=T.find(function(e){return e.source===k.source});u.text(e.title),E.onLoad()}}}}else a.audioPlayer[i]={source:null,seconds:0},E.isIOS()&&(s.autoplay=!0);s.addEventListener("durationchange",E.onDurationChange,!1),s.addEventListener("timeupdate",E.onTimeUpdate,!1),s.addEventListener("play",E.onPlay,!1),s.addEventListener("ended",E.onEnd,!1),s.addEventListener("pause",E.onPause,!1),d.click(E.hideVolume),f.click(E.togglePlay),g.click(E.toggleVolume),p.click(E.pauseAudio),v.click(function(e){e.stopPropagation()}),A.change(E.setVolume),z.click(E.toggleMute),h.on("vmousedown",E.onProgressPress),o.on("vmouseup",E.onMouseUp),o.on("vmousemove",E.onMouseMove),n&&(E.buildEpisodes(),E.showPlaying()),e.fn.drzAudioPlayer.destroy=function(e,r){e.find(".drzAudio-playBtn").off("click").removeClass("drzAudio-pauseBtn drzAudio-replayBtn"),e.find(".drzAudio-pauseBtn").off("click"),e.find(".drzAudio-volSlider").off("change"),e.find(".drzAudio-muteBtn").off("click"),e.find(".drzAudio-progressBar").off("vmousedown"),e.find(".drzAudio-volumeBtn").off("click"),o.off("vmouseup",E.onMouseUp),o.off("vmousemove",E.onMouseMove),d.off("click"),window.__editor&&!r&&e.next(".drzAudio-episodes-container").remove();var i=e.find(".drzAudio-src").get(0);i.removeEventListener("durationchange",E.onDurationChange,!1),i.removeEventListener("timeupdate",E.onTimeUpdate,!1),i.removeEventListener("play",E.onPlay,!1),i.removeEventListener("ended",E.onEnd,!1),i.removeEventListener("pause",E.onPause,!1)}}),this}}(jQuery);