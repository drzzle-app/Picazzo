"use strict";var _typeof2=require("babel-runtime/helpers/typeof"),_typeof3=_interopRequireDefault(_typeof2);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}!function(e){e.fn.drzCountDown=function(){return e(this).each(function(){var t=e(this),n=t.find(".drzCountdown-endedMsg"),r=t.find(".drzCountdown-timerContainer"),i=void 0,o=void 0,a=void 0,u={tempDate:function(){var e=new Date((new Date).getTime()+864e5);return e},orderSets:function(e,t){return new Date(e.end).getTime()-new Date(t.end).getTime()},getBuffer:function(e){var t=!1;if(e.buffer){var n=e.buffer.split(" ")[1],r=e.buffer.split(" ")[0];r=parseInt(r,10),n.match(/second/gi)?t=1e3*r:n.match(/minute/gi)?t=60*r*1e3:n.match(/hour/gi)&&(t=3600*r*1e3),t=new Date(e.end).getTime()+t,t=new Date(t)}return t},getRemainingTime:function(e){var t=new Date,n=Date.parse(e)-Date.parse(t),r=Math.floor(n/1e3%60);r<0&&(r=0);var i=Math.floor(n/1e3/60%60);i<0&&(i=0);var o=Math.floor(n/36e5%24);o<0&&(o=0);var a=Math.floor(n/864e5);return a<0&&(a=0),{total:n,days:a,hours:o,minutes:i,seconds:r}},checkStart:function(e,i,o){var a=!1;return u.getRemainingTime(e.end).total<=0?(a=!0,u.countDownEnded(t,i,o)):(n.hide(),r.show()),a},updateTime:function(e,n,r,o){var a=e.find(".drzCountdown-days"),s=e.find(".drzCountdown-hours"),d=e.find(".drzCountdown-minutes"),c=e.find(".drzCountdown-seconds"),f=u.getRemainingTime(n.end);a.html(f.days),s.html(("0"+f.hours).slice(-2)),d.html(("0"+f.minutes).slice(-2)),c.html(("0"+f.seconds).slice(-2)),f.total<=0&&(clearInterval(i),u.countDownEnded(t,r,o))},sameTime:function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()&&e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes()&&e.getSeconds()===t.getSeconds()},getNextOccurance:function(e){var t=new Date(e.end),n=t.getSeconds(),r=t.getMinutes(),i=t.getHours(),o=new Date,a=new Date,s=void 0;if(e.recurring.match(/week/gi)){var d=e.end.toString();(d=d.split(" ")[0]).match(/Sun/gi)?s=0:d.match(/Mon/gi)?s=1:d.match(/Tue/gi)?s=2:d.match(/Wed/gi)?s=3:d.match(/Thu/gi)?s=4:d.match(/Fri/gi)?s=5:d.match(/Sat/gi)&&(s=6);var c=s+(7-o.getDay());a.setDate(o.getDate()+c%7),a.setSeconds(n),a.setMinutes(r),a.setHours(i),(a<new Date||u.sameTime(a,new Date))&&a.setUTCDate(a.getUTCDate()+7)}return a},recurring:function(e){for(var i=[],o=0;o<=e.length-1;o++){var a=e[o];a.recurring&&(a.end=u.getNextOccurance(a),i.push(a))}i.length>0&&(n.hide(),r.show(),i=i.sort(u.orderSets),u.initCountDown(t,i[0],i,0))},countDownEnded:function(e,a,s){clearInterval(o),clearInterval(i);var d=a[s];r.hide(),n.show(),n.html('<h4 class="drz-h4 drzCountdown-endMessage">\n              '+(d.endMessage||"")+"\n            </h4>");var c=s+1,f=a[c],g=u.getBuffer(d);"undefined"!==(void 0===f?"undefined":(0,_typeof3.default)(f))&&!1!==f?g?o=setInterval(function(){u.getRemainingTime(g).total<=0&&(n.hide(),r.show(),u.initCountDown(t,f,a,c),clearInterval(o))},500):(n.hide(),r.show(),u.initCountDown(t,f,a,c)):d.buffer?o=setInterval(function(){u.getRemainingTime(g).total<=0&&(n.hide(),r.show(),u.recurring(a),clearInterval(o))},100):u.recurring(a)},initCountDown:function(e,t,n,r){u.updateTime(e,t,n,r),i=setInterval(function(){u.updateTime(e,t,n,r)},1e3)}};function s(){var n=t.attr("data-countdown"),r=[{end:u.tempDate(),buffer:!1,endMessage:"Countdown Ended!",recurring:!1}];if("undefined"!==(void 0===n?"undefined":(0,_typeof3.default)(n))&&!1!==n)if(n=JSON.parse(n),a=n.sets.length,n.sets=n.sets.sort(u.orderSets),a>0)for(var i=0;i<=a-1;i++){var o=e.extend(!0,{},r[0],n.sets[i]);if(n.sets[i]=o,!u.checkStart(o,n.sets,i))return void u.initCountDown(t,o,n.sets,i)}else u.initCountDown(t,r[0],r,0);else u.initCountDown(t,r[0],r,0)}s(),e.fn.drzCountDown.reset=function(){clearInterval(i),clearInterval(o),s()}}),this}}(jQuery);