"use strict";!function(e){e.fn.drzVideoPlayer=function(){var o=e(this),i=e(document),r=o.attr("data-player-id"),n=o.attr("data-episodes"),d=window.localStorage.getItem("drzzleStorage"),t=d?JSON.parse(d):{};return t.videoPlayer=t.videoPlayer||{},o.each(function(){var d=e(this),s=d.find(".drzVideo-src"),l=s.get(0),a=s.find("source"),c=d.get(0),u=d.find(".drzVideo-controls"),f=u.find("button"),m=d.find(".drzVideo-playBtn"),v=d.find(".drzVideo-volSlider"),p=d.find(".drzVideo-volBtn"),g=p.find(".drzVideo-btn-tooltip"),h=d.find(".drzVideo-progress"),V=d.find(".drzVideo-progressBar"),z=d.find(".drzVideo-buffer"),y=d.find(".drzVideo-timeline-tooltip"),w=d.find(".drzVideo-fullScreenBtn"),C=d.find(".drzVideo-currentTime"),P=d.find(".drzVideo-totalTime"),S=d.find(".drzVideo-videoTime"),E=d.find(".drzVideo-volSliderContainer"),x=d.find(".drzVideo-overlay"),b=x.find(".drzVideo-playBtn-lrg"),T=a.attr("src");C.html("0:00"),d.find(".drzVideo-src").load();var k={onVideoLoad:function(){k.setLoading(!1)},loading:!1,setLoading:function(e){k.loading=e,k.$errorEl.hide(),e?(x.addClass("drzVideo-loading"),b.hide(),k.loadTimeout=setTimeout(k.onLoadTimeout,2e4)):(x.removeClass("drzVideo-loading"),b.show(),k.loadTimeout&&clearTimeout(k.loadTimeout))},loadTimeout:null,onLoadTimeout:function(){k.$errorEl.text("There was an issue loading video."),k.$errorEl.show(),b.hide(),x.removeClass("drzVideo-loading"),k.loading=!1},getTotalTime:function(){var e=parseInt(l.duration/60,10),o=parseInt(l.duration%60,10),i=parseInt(e/60,10);o=o<10?":0"+o:":"+o,i>0?i+=":":i="",P.html(i+e+o);var r=d.parent();r.hasClass("drzVideo-feature")&&(r.find(".drzVideo-featureDuration").html("0:00"),r.find(".drzVideo-featureTotalTime").html(i+e+o))},onTimeUpdate:function(){var e=parseInt(l.currentTime/60,10),o=parseInt(l.currentTime%60,10),i=parseInt(e/60,10),n=parseInt(l.currentTime.toFixed(0),10),s=parseInt(t.videoPlayer[r].seconds,10);0!==n&&n!==s&&(t.videoPlayer[r].seconds=n,window.localStorage.setItem("drzzleStorage",JSON.stringify(t)));var a=0;l.currentTime>0&&(a=Math.floor(100/l.duration*l.currentTime)),o=o<10?":0"+o:":"+o,i>0?i+=":":i="",h.css("width",a+"%"),C.html(i+e+o);var c=d.parent();c.hasClass("drzVideo-feature")&&c.find(".drzVideo-featureDuration").html(i+e+o)},onEnded:function(){if(x.css("opacity",1),b.is(":visible")||b.show(),b.addClass("drzVideo-replayBtn"),m.find(".drzVideo-playBtn-inner").removeClass("drzVideo-play-icon drzVideo-pause-icon").addClass("drzVideo-replayBtn"),m.find(".drzVideo-btn-tooltip").text("Replay (p)"),n){var e=a.attr("src");k.$listContainer.find('[data-video-src="'+e+'"]').find(".drzVideo-episodes-rcol").removeClass("drzVideo-playing")}},updateProgress:function(e){var o=l.duration,i=(e-V.offset().left)/V.width()*100;i>100&&(i=100),i<0&&(i=0),l.currentTime=o*(i/100),h.css("width",i+"%")},displayTime:function(e){var o=~~(e/3600),i=~~(e%3600/60),r=~~e%60,n="";return o>0&&(n+=o+":"+(i<10?"0":"")),n+=i+":"+(r<10?"0":""),n+=""+r},progressDrag:!1,onProgressHover:function(e){y.show();var o=l.duration,i=e.pageX-V.offset().left,r=i/V.width()*100;r>100&&(r=100),r<0&&(r=0);var n=V.width(),d=Math.round(o*(r/100)),t=k.displayTime(d);y.text(t);var s=y.outerWidth()/2;if(i>=0&&i<=n){y.css("left",i-s+"px");var a=k.posCheck(V,y);a.bleeding&&y.css("left",i-s-a.diff+"px")}},posCheck:function(e,o){var i=e.get(0).getBoundingClientRect(),r=o.get(0).getBoundingClientRect(),n=r.left<=i.left,d=r.right>=i.right,t=n||d,s=void 0,l=0;return n&&(l=r.left-i.left,s="left"),d&&(l=r.right-i.right,s="right"),{bleeding:t,diff:l,bleedDir:s}},onProgressLeave:function(){y.hide()},setProgress:function(e){k.progressDrag=!0,k.updateProgress(e.pageX)},onMouseUp:function(e){i.find("body").removeClass("drz-mousedown"),k.progressDrag&&(k.progressDrag=!1,k.updateProgress(e.pageX))},onMouseDown:function(){i.find("body").addClass("drz-mousedown")},onMouseMove:function(e){k.progressDrag&&k.updateProgress(e.pageX)},hideControls:null,slideControlsUp:function(){!k.isIOS()&&u.hasClass("drzVide-slideDown")&&(u.removeClass("drzVide-slideDown"),h.removeClass("drzVideo-soloProgress"),V.removeClass("drzVideo-soloProgress"),clearTimeout(k.hideControls),k.hideControls=setTimeout(function(){u.hasClass("drzVide-slideDown")||(u.addClass("drzVide-slideDown"),h.addClass("drzVideo-soloProgress"),V.addClass("drzVideo-soloProgress"))},3e3))},clearTime:function(){return clearTimeout(k.hideControls)},slideControlsDown:function(){k.isIOS()||(clearTimeout(k.hideControls),k.hideControls=setTimeout(function(){u.hasClass("drzVide-slideDown")||(u.addClass("drzVide-slideDown"),h.addClass("drzVideo-soloProgress"),V.addClass("drzVideo-soloProgress"))},3e3))},offHover:function(){k.isIOS()||(clearTimeout(k.hideControls),u.hasClass("drzVide-slideDown")||(u.addClass("drzVide-slideDown"),h.addClass("drzVideo-soloProgress"),V.addClass("drzVideo-soloProgress")))},toggleControls:function(){d.on("vmousemove",k.slideControlsUp),d.find(".drzVideo-controlBar").on("vmouseover",k.clearTime),d.find(".drzVideo-controlBar").on("mouseleave",k.slideControlsDown),d.mouseleave(k.offHover),k.slideControlsDown()},onPlay:function(){x.css("opacity",0),b.removeClass("drzVideo-replayBtn"),b.is(":visible")&&b.hide(),m.find(".drzVideo-playBtn-inner").removeClass("drzVideo-play-icon drzVideo-replayBtn").addClass("drzVideo-pause-icon"),m.find(".drzVideo-btn-tooltip").text("Pause (p)");var e=s.find("source").attr("src");(t.videoPlayer[r].source=e,n)&&k.$listContainer.find(".drzVideo-episodes-livebtn").parent().addClass("drzVideo-playing")},onPause:function(){if(m.find(".drzVideo-playBtn-inner").removeClass("drzVideo-pause-icon drzVideo-replayBtn").addClass("drzVideo-play-icon"),x.css("opacity",1),b.is(":visible")||b.show(),m.find(".drzVideo-btn-tooltip").text("Play (p)"),window.matchMedia(drzzle.viewports.mobile).matches&&k.slideControlsUp(),n){var e=a.attr("src");k.$listContainer.find('[data-video-src="'+e+'"]').find(".drzVideo-episodes-rcol").removeClass("drzVideo-playing")}},togglePlay:function(e){k.loading||(m.find(".drzVideo-playBtn-inner").hasClass("drzVideo-play-icon")||m.find(".drzVideo-playBtn-inner").hasClass("drzVideo-replayBtn")?k.playVideo(e):k.pauseVideo(e)),k.$errorEl&&k.$errorEl.hide()},playVideo:function(){(l.paused||l.ended)&&l.play()},pauseVideo:function(){l.pause()},setVolume:function(e){var o=v.val();l.volume=o,0===o&&k.toggleMute(e,!0),k.setVolumeIcon()},volMouseUp:function(){v.blur()},setVolumeIcon:function(){var e=p.find(".drzVideo-volBtn-inner"),o=~~v.attr("max"),i=(v.val()/o*100).toFixed(0);e.removeClass("drzVideo-vol-mute drzVideo-vol-min drzVideo-vol-med drzVideo-vol-max");var r="";0==~~i?(r="drzVideo-vol-mute",g.text("Unmute (m)")):g.text("Mute (m)"),i>0&&i<=30&&(r="drzVideo-vol-min"),i>30&&i<=70&&(r="drzVideo-vol-med"),i>70&&i<=100&&(r="drzVideo-vol-max"),e.addClass(r)},lastVolume:null,isMuted:!1,toggleMute:function(e,o){e&&e.stopPropagation(),k.isMuted?(l.volume=k.lastVolume,v.val(k.lastVolume),g.text("Mute (m)"),k.isMuted=!1):(k.lastVolume=v.val(),l.volume=0,v.val(0),g.text("Unmute (m)"),k.isMuted=!0),o||k.setVolumeIcon()},onButtonHover:function(o){var i=e(o.target).parent().prev(".drzVideo-btn-tooltip");if(i.length>0){var r=k.posCheck(V,i);r.bleeding&&i.css({left:50-r.diff+"%",transform:"translateX("+(-50-r.diff)+"%)"})}},onButtoneLeave:function(o){var i=e(o.target).parent().prev(".drzVideo-btn-tooltip");i.length>0&&i.css({left:"",transform:""})},fastForward:function(e){l.currentTime+=e},rewind:function(e){l.currentTime-=e},onKeydown:function(e){var o="BODY"===e.target.tagName,i=e.key||e.which;o&&"p"===i&&k.togglePlay(),o&&"m"===i&&k.toggleMute(),o&&"f"===i&&k.toggleFullScreen(),o&&"ArrowRight"===i&&k.fastForward(5),o&&"ArrowLeft"===i&&k.rewind(5)},isFullScreen:!1,toggleFullScreen:function(e){k.isFullScreen=!k.isFullScreen,e&&e.stopPropagation(),k.isIOS()&&l.webkitEnterFullscreen(),void 0!==document.fullScreenElement&&null===document.fullScreenElement||void 0!==document.msFullscreenElement&&null===document.msFullscreenElement||void 0!==document.mozFullScreen&&!document.mozFullScreen||void 0!==document.webkitIsFullScreen&&!document.webkitIsFullScreen?c.requestFullScreen?c.requestFullScreen():c.mozRequestFullScreen?c.mozRequestFullScreen():c.webkitRequestFullScreen?c.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):c.msRequestFullscreen&&c.msRequestFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},fullscreenChecks:function(){var e=w.find(".drzVideo-btn-tooltip"),o=document.fullscreenElement,i=document.msFullscreenElement,r=document.mozFullScreen,n=document.webkitIsFullScreen;o||i||r||n?e.text("Exit full screen (f)"):e.text("Full screen (f)")},bindFullScreenEvents:function(){document.addEventListener("fullscreenchange",k.fullscreenChecks),document.addEventListener("mozfullscreenchange",k.fullscreenChecks),document.addEventListener("webkitfullscreenchange",k.fullscreenChecks),document.addEventListener("msfullscreenchange",k.fullscreenChecks)},destroyFullScreenEvents:function(){document.removeEventListener("fullscreenchange",k.fullscreenChecks),document.removeEventListener("mozfullscreenchange",k.fullscreenChecks),document.removeEventListener("webkitfullscreenchange",k.fullscreenChecks),document.removeEventListener("msfullscreenchange",k.fullscreenChecks)},buildToolTips:function(){m.find(".drzVideo-btn-tooltip").text("Play (p)"),p.find(".drzVideo-btn-tooltip").text("Mute (m)"),w.find(".drzVideo-btn-tooltip").text("Full screen (f)")},onBuffer:function(){var e=l.duration;if(e>0)for(var o=0;o<l.buffered.length;o++)if(l.buffered.start(l.buffered.length-1-o)<l.currentTime){var i=l.buffered.end(l.buffered.length-1-o)/e*100;z.css({width:Math.floor(i)+"%"});break}},$listContainer:null,showPlaying:function(){var o=a.attr("src");k.$listContainer.find("[data-video-src]").each(function(){var i=e(this);i.find(".drzVideo-episodes-rcol").removeClass("drzVideo-playing");var r=i.find(".drzVideo-episodes-plbtn");i.attr("data-video-src")===o?r.addClass("drzVideo-episodes-livebtn"):r.removeClass("drzVideo-episodes-livebtn")})},onClickTrack:function(i){if(i.preventDefault(),!k.loading){k.setLoading(!0);var n=e(i.target).closest("[data-video-src]").attr("data-video-src");o.drzVideoPlayer.destroy(o,"play"),t.videoPlayer[r].source=n,t.videoPlayer[r].seconds=0,window.localStorage.setItem("drzzleStorage",JSON.stringify(t)),a.attr("src",n);var s=document.createElement("video");s.src=n,k.isIOS()&&(s.autoplay=!0),s.onloadeddata=function(){s.pause(),s.remove(),o.drzVideoPlayer(),k.setLoading(!1),k.showPlaying(),k.isIOS()||(d.trigger("click"),k.togglePlay())}}},buildEpisodes:function(){var i=JSON.parse(n).list,r=o.next(".drzVideo-episodes-container");if(r.length)k.$listContainer=r;else{var d=e('<div class="drzVideo-episodes-container"></div>');i.forEach(function(i){var r=e('<a class="drzVideo-episodes-item" data-video-src="'+i.source+'" href="#">\n                  <div class="drzVideo-episodes-data">\n                    <span class="drzVideo-episodes-title">'+i.title+'</span>\n                    <span class="drzVideo-episodes-date">Published - '+i.published+'</span>\n                  </div>\n                  <div class="drzVideo-episodes-rcol">\n                    <div class="drzVideo-episode-playing">\n                      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px"\n                         height="24px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">\n                         <g id="Layer_2">\n                            <path class="drzVideo-film-base" d="M40,0H10H0v16.667v16.667V50h10h30h10V33.333V16.667V0H40z M40,2v12.667H10V2H40z M40,18.667v12.667H10V18.667H40z M10,48\n                               V35.333h30V48H10z"/>\n                         </g>\n                         <g id="Layer_1">\n                            <rect x="2.917" y="2.083" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="2.917" y="10.417" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="2.917" y="18.75" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="2.917" y="27.083" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="2.917" y="35.417" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="2.917" y="43.75" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="42.917" y="2.083" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="42.917" y="10.417" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="42.917" y="18.75" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="42.917" y="27.083" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="42.917" y="35.417" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="42.917" y="43.75" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="42.917" y="52.083" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="42.917" y="60.417" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="42.917" y="68.75" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="42.917" y="77.083" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="2.917" y="52.083" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="2.917" y="60.417" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="2.917" y="68.75" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                            <rect x="2.917" y="77.083" class="drzVideo-film-strip" width="4.167" height="4.167"/>\n                         </g>\n                      </svg>\n                    </div>\n                    <span class="drzVideo-episodes-plbtn"></span>\n                  </div>\n                </a>');r.click(k.onClickTrack),d.append(r),d.insertAfter(o)}),k.$listContainer=d}},isIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)},iosChecks:function(){k.isIOS()&&(p.hide(),E.hide())},$errorEl:null,addErrorMessage:function(){var o=x.find(".drzVideo-error-message");if(o.length)k.$errorEl=o;else{var i=e('<div class="drzVideo-error-message"></div>');x.append(i),k.$errorEl=i}}};k.isIOS()&&s.attr("playsinline",!0),k.addErrorMessage(),m.find(".drzVideo-playBtn-inner").addClass("drzVideo-play-icon");var L=t.videoPlayer[r];if(L){if(!n&&L.source===T){k.setLoading(!0);var F=document.createElement("video");F.src=T,k.isIOS()&&(F.autoplay=!0),F.onloadeddata=function(){F.pause(),F.remove(),l.currentTime=L.seconds,k.setLoading(!1)}}if(n)if(JSON.parse(n).list.map(function(e){return e.source}).includes(L.source)){k.setLoading(!0),a.attr("src",L.source);var B=document.createElement("video");B.src=L.source,k.isIOS()&&(B.autoplay=!0),B.onloadeddata=function(){B.pause(),B.remove(),l.currentTime=L.seconds,k.setLoading(!1)}}}else t.videoPlayer[r]={source:null,seconds:0};k.iosChecks(),l.addEventListener("progress",k.onBuffer),d.one("click",k.toggleControls),k.bindFullScreenEvents(),k.buildToolTips(),i.on("vmousedown",k.onMouseDown),i.on("vmouseup",k.onMouseUp),i.on("vmousemove",k.onMouseMove),S.click(function(e){return e.stopPropagation()}),E.click(function(e){return e.stopPropagation()}),x.click(k.togglePlay),l.addEventListener("durationchange",k.getTotalTime,!1),l.addEventListener("timeupdate",k.onTimeUpdate,!1),l.addEventListener("ended",k.onEnded,!1),l.addEventListener("play",k.onPlay,!1),l.addEventListener("pause",k.onPause,!1),V.on("vmousemove",k.onProgressHover),V.on("vmouseout",k.onProgressLeave),V.on("vmousedown",k.setProgress),f.on("vmouseover",k.onButtonHover),f.on("vmouseout",k.onButtoneLeave),document.addEventListener("keydown",k.onKeydown),m.on("click",k.togglePlay),v.change(k.setVolume),v.on("vmouseup",k.volMouseUp),p.click(k.toggleMute),w.click(k.toggleFullScreen),k.setVolumeIcon(),n&&(k.buildEpisodes(),k.showPlaying()),e.fn.drzVideoPlayer.destroy=function(e,o){e.off("click"),e.off("mouseleave"),e.off("vmousemove"),e.find(".drzVideo-videoTime").off("click"),e.find(".drzVideo-volSliderContainer").off("click"),e.find(".drzVideo-overlay").off("click"),e.find(".drzVideo-progressBar").off("vmousedown",k.setProgress),e.find(".drzVideo-progressBar").off("vmousemove",k.onProgressHover),e.find(".drzVideo-progressBar").off("vmouseout",k.onProgressLeave),e.find(".drzVideo-controls button").on("vmouseover",k.onButtonHover),e.find(".drzVideo-playBtn-inner").off("click").removeClass("drzVideo-pause-icon drzVideo-play-icon"),e.find(".drzVideo-volSlider").off("change"),e.find(".drzVideo-volSlider").off("vmouseup",k.volMouseUp),e.find(".drzVideo-volBtn-inner").off("click"),e.find(".drzVideo-fullScreenBtn-inner").off("click"),document.removeEventListener("keydown",k.onKeydown),i.off("vmousedown",k.onMouseDown),i.off("vmouseup",k.onMouseUp),i.off("vmousemove",k.onMouseMove);var r=e.find(".drzVideo-src").get(0);r.removeEventListener("loadeddata",k.onVideoLoad),r.removeEventListener("progress",k.onBuffer),r.removeEventListener("durationchange",k.getTotalTime,!1),r.removeEventListener("timeupdate",k.onTimeUpdate,!1),r.removeEventListener("ended",k.onEnded,!1),r.removeEventListener("play",k.onPlay,!1),r.removeEventListener("pause",k.onPause,!1);var n=e.find(".drzVideo-controlBar");n.off("vmouseover"),n.off("mouseleave"),k.destroyFullScreenEvents(),window.__editor&&!o&&e.next(".drzVideo-episodes-container").remove()}}),this}}(jQuery);