"use strict";!function(e){e.fn.drzVideoPlayer=function(){var o=e(this),n=e(document),r=o.attr("data-player-id"),d=o.attr("data-episodes"),i=window.localStorage.getItem("drzzleStorage"),t=i?JSON.parse(i):{};return t.videoPlayer=t.videoPlayer||{},o.each(function(){var i=e(this),s=i.find(".drzVideo-src"),l=s.get(0),a=s.find("source"),u=i.get(0),c=i.find(".drzVideo-controls"),f=c.find("button"),v=i.find(".drzVideo-playBtn"),m=i.find(".drzVideo-volSlider"),p=i.find(".drzVideo-volBtn"),g=p.find(".drzVideo-btn-tooltip"),z=i.find(".drzVideo-progress"),V=i.find(".drzVideo-progressBar"),h=i.find(".drzVideo-buffer"),C=i.find(".drzVideo-timeline-tooltip"),y=i.find(".drzVideo-fullScreenBtn"),w=i.find(".drzVideo-currentTime"),P=i.find(".drzVideo-totalTime"),S=i.find(".drzVideo-videoTime"),E=i.find(".drzVideo-volSliderContainer"),b=i.find(".drzVideo-overlay"),T=b.find(".drzVideo-playBtn-lrg"),k=a.attr("src");w.html("0:00"),i.find(".drzVideo-src").load();var L={onVideoLoad:function(){L.setLoading(!1)},loading:!1,setLoading:function(e){L.loading=e,L.$errorEl.hide(),e?(b.addClass("drzVideo-loading"),T.hide(),L.loadTimeout=setTimeout(L.onLoadTimeout,2e4)):(b.removeClass("drzVideo-loading"),T.show(),L.loadTimeout&&clearTimeout(L.loadTimeout))},loadTimeout:null,onLoadTimeout:function(){L.$errorEl.text("There was an issue loading video."),L.$errorEl.show(),T.hide(),b.removeClass("drzVideo-loading"),L.loading=!1},getTotalTime:function(){var e=parseInt(l.duration/60,10),o=parseInt(l.duration%60,10),n=parseInt(e/60,10);o=o<10?":0"+o:":"+o,n>0?n+=":":n="",P.html(n+e+o);var r=i.parent();r.hasClass("drzVideo-feature")&&(r.find(".drzVideo-featureDuration").html("0:00"),r.find(".drzVideo-featureTotalTime").html(n+e+o))},onTimeUpdate:function(){var e=parseInt(l.currentTime/60,10),o=parseInt(l.currentTime%60,10),n=parseInt(e/60,10),d=parseInt(l.currentTime.toFixed(0),10),s=parseInt(t.videoPlayer[r].seconds,10);0!==d&&d!==s&&(t.videoPlayer[r].seconds=d,window.localStorage.setItem("drzzleStorage",JSON.stringify(t)));var a=0;l.currentTime>0&&(a=Math.floor(100/l.duration*l.currentTime)),o=o<10?":0"+o:":"+o,n>0?n+=":":n="",z.css("width",a+"%"),w.html(n+e+o);var u=i.parent();u.hasClass("drzVideo-feature")&&u.find(".drzVideo-featureDuration").html(n+e+o)},onEnded:function(){if(b.css("opacity",1),T.is(":visible")||T.show(),T.addClass("drzVideo-replayBtn"),v.find(".drzVideo-playBtn-inner").removeClass("drzVideo-play-icon drzVideo-pause-icon").addClass("drzVideo-replayBtn"),v.find(".drzVideo-btn-tooltip").text("Replay (p)"),d){var e=a.attr("src");L.$listContainer.find('[data-video-src="'+e+'"]').find(".drzVideo-episodes-rcol").removeClass("drzVideo-playing")}},updateProgress:function(e){var o=l.duration,n=(e-V.offset().left)/V.width()*100;n>100&&(n=100),n<0&&(n=0),l.currentTime=o*(n/100),z.css("width",n+"%")},displayTime:function(e){var o=~~(e/3600),n=~~(e%3600/60),r=~~e%60,d="";return o>0&&(d+=o+":"+(n<10?"0":"")),d+=n+":"+(r<10?"0":""),d+=""+r},progressDrag:!1,onProgressHover:function(e){C.show();var o=l.duration,n=e.pageX-V.offset().left,r=n/V.width()*100;r>100&&(r=100),r<0&&(r=0);var d=V.width(),i=Math.round(o*(r/100)),t=L.displayTime(i);C.text(t);var s=C.outerWidth()/2;if(n>=0&&n<=d){C.css("left",n-s+"px");var a=L.posCheck(V,C);a.bleeding&&C.css("left",n-s-a.diff+"px")}},posCheck:function(e,o){var n=e.get(0).getBoundingClientRect(),r=o.get(0).getBoundingClientRect(),d=r.left<=n.left,i=r.right>=n.right,t=d||i,s=void 0,l=0;return d&&(l=r.left-n.left,s="left"),i&&(l=r.right-n.right,s="right"),{bleeding:t,diff:l,bleedDir:s}},onProgressLeave:function(){C.hide()},setProgress:function(e){L.progressDrag=!0,L.updateProgress(e.pageX)},onMouseUp:function(e){n.find("body").removeClass("drz-mousedown"),L.progressDrag&&(L.progressDrag=!1,L.updateProgress(e.pageX))},onMouseDown:function(){n.find("body").addClass("drz-mousedown")},onMouseMove:function(e){L.progressDrag&&L.updateProgress(e.pageX)},hideControls:null,slideControlsUp:function(){!L.isIOS()&&c.hasClass("drzVide-slideDown")&&(c.removeClass("drzVide-slideDown"),z.removeClass("drzVideo-soloProgress"),V.removeClass("drzVideo-soloProgress"),clearTimeout(L.hideControls),L.hideControls=setTimeout(function(){c.hasClass("drzVide-slideDown")||(c.addClass("drzVide-slideDown"),z.addClass("drzVideo-soloProgress"),V.addClass("drzVideo-soloProgress"))},3e3))},clearTime:function(){return clearTimeout(L.hideControls)},slideControlsDown:function(){L.isIOS()||(clearTimeout(L.hideControls),L.hideControls=setTimeout(function(){c.hasClass("drzVide-slideDown")||(c.addClass("drzVide-slideDown"),z.addClass("drzVideo-soloProgress"),V.addClass("drzVideo-soloProgress"))},3e3))},offHover:function(){L.isIOS()||(clearTimeout(L.hideControls),c.hasClass("drzVide-slideDown")||(c.addClass("drzVide-slideDown"),z.addClass("drzVideo-soloProgress"),V.addClass("drzVideo-soloProgress")))},toggleControls:function(){i.on("vmousemove",L.slideControlsUp),i.find(".drzVideo-controlBar").on("vmouseover",L.clearTime),i.find(".drzVideo-controlBar").on("mouseleave",L.slideControlsDown),i.mouseleave(L.offHover),L.slideControlsDown()},onPlay:function(){b.css("opacity",0),T.removeClass("drzVideo-replayBtn"),T.is(":visible")&&T.hide(),v.find(".drzVideo-playBtn-inner").removeClass("drzVideo-play-icon drzVideo-replayBtn").addClass("drzVideo-pause-icon"),v.find(".drzVideo-btn-tooltip").text("Pause (p)");var e=s.find("source").attr("src");(t.videoPlayer[r].source=e,d)&&L.$listContainer.find(".drzVideo-episodes-livebtn").parent().addClass("drzVideo-playing")},onPause:function(){if(v.find(".drzVideo-playBtn-inner").removeClass("drzVideo-pause-icon drzVideo-replayBtn").addClass("drzVideo-play-icon"),b.css("opacity",1),T.is(":visible")||T.show(),v.find(".drzVideo-btn-tooltip").text("Play (p)"),window.matchMedia(drzzle.viewports.mobile).matches&&L.slideControlsUp(),d){var e=a.attr("src");L.$listContainer.find('[data-video-src="'+e+'"]').find(".drzVideo-episodes-rcol").removeClass("drzVideo-playing")}},togglePlay:function(e){L.loading||(v.find(".drzVideo-playBtn-inner").hasClass("drzVideo-play-icon")||v.find(".drzVideo-playBtn-inner").hasClass("drzVideo-replayBtn")?L.playVideo(e):L.pauseVideo(e)),L.$errorEl&&L.$errorEl.hide()},playVideo:function(){(l.paused||l.ended)&&l.play()},pauseVideo:function(){l.pause()},setVolume:function(e){var o=m.val();l.volume=o,0===o&&L.toggleMute(e,!0),L.setVolumeIcon()},volMouseUp:function(){m.blur()},setVolumeIcon:function(){var e=p.find(".drzVideo-volBtn-inner"),o=~~m.attr("max"),n=(m.val()/o*100).toFixed(0);e.removeClass("drzVideo-vol-mute drzVideo-vol-min drzVideo-vol-med drzVideo-vol-max");var r="";0==~~n?(r="drzVideo-vol-mute",g.text("Unmute (m)")):g.text("Mute (m)"),n>0&&n<=30&&(r="drzVideo-vol-min"),n>30&&n<=70&&(r="drzVideo-vol-med"),n>70&&n<=100&&(r="drzVideo-vol-max"),e.addClass(r)},lastVolume:null,isMuted:!1,toggleMute:function(e,o){e&&e.stopPropagation(),L.isMuted?(l.volume=L.lastVolume,m.val(L.lastVolume),g.text("Mute (m)"),L.isMuted=!1):(L.lastVolume=m.val(),l.volume=0,m.val(0),g.text("Unmute (m)"),L.isMuted=!0),o||L.setVolumeIcon()},onButtonHover:function(o){var n=e(o.target).parent().prev(".drzVideo-btn-tooltip");if(n.length>0){var r=L.posCheck(V,n);r.bleeding&&n.css({left:50-r.diff+"%",transform:"translateX("+(-50-r.diff)+"%)"})}},onButtoneLeave:function(o){var n=e(o.target).parent().prev(".drzVideo-btn-tooltip");n.length>0&&n.css({left:"",transform:""})},fastForward:function(e){l.currentTime+=e},rewind:function(e){l.currentTime-=e},onKeydown:function(e){var o="BODY"===e.target.tagName,n=e.key||e.which;o&&"p"===n&&L.togglePlay(),o&&"m"===n&&L.toggleMute(),o&&"f"===n&&L.toggleFullScreen(),o&&"ArrowRight"===n&&L.fastForward(5),o&&"ArrowLeft"===n&&L.rewind(5)},isFullScreen:!1,toggleFullScreen:function(e){L.isFullScreen=!L.isFullScreen,e&&e.stopPropagation(),L.isIOS()&&l.webkitEnterFullscreen(),void 0!==document.fullScreenElement&&null===document.fullScreenElement||void 0!==document.msFullscreenElement&&null===document.msFullscreenElement||void 0!==document.mozFullScreen&&!document.mozFullScreen||void 0!==document.webkitIsFullScreen&&!document.webkitIsFullScreen?u.requestFullScreen?u.requestFullScreen():u.mozRequestFullScreen?u.mozRequestFullScreen():u.webkitRequestFullScreen?u.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):u.msRequestFullscreen&&u.msRequestFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},fullscreenChecks:function(){var e=y.find(".drzVideo-btn-tooltip"),o=document.fullscreenElement,n=document.msFullscreenElement,r=document.mozFullScreen,d=document.webkitIsFullScreen;o||n||r||d?e.text("Exit full screen (f)"):e.text("Full screen (f)")},bindFullScreenEvents:function(){document.addEventListener("fullscreenchange",L.fullscreenChecks),document.addEventListener("mozfullscreenchange",L.fullscreenChecks),document.addEventListener("webkitfullscreenchange",L.fullscreenChecks),document.addEventListener("msfullscreenchange",L.fullscreenChecks)},destroyFullScreenEvents:function(){document.removeEventListener("fullscreenchange",L.fullscreenChecks),document.removeEventListener("mozfullscreenchange",L.fullscreenChecks),document.removeEventListener("webkitfullscreenchange",L.fullscreenChecks),document.removeEventListener("msfullscreenchange",L.fullscreenChecks)},buildToolTips:function(){v.find(".drzVideo-btn-tooltip").text("Play (p)"),p.find(".drzVideo-btn-tooltip").text("Mute (m)"),y.find(".drzVideo-btn-tooltip").text("Full screen (f)")},onBuffer:function(){var e=l.duration;if(e>0)for(var o=0;o<l.buffered.length;o++)if(l.buffered.start(l.buffered.length-1-o)<l.currentTime){var n=l.buffered.end(l.buffered.length-1-o)/e*100;h.css({width:Math.floor(n)+"%"});break}},$listContainer:null,showPlaying:function(){var o=a.attr("src");L.$listContainer.find("[data-video-src]").each(function(){var n=e(this);n.find(".drzVideo-episodes-rcol").removeClass("drzVideo-playing");var r=n.find(".drzVideo-episodes-plbtn");n.attr("data-video-src")===o?r.addClass("drzVideo-episodes-livebtn"):r.removeClass("drzVideo-episodes-livebtn")})},onClickTrack:function(n){if(n.preventDefault(),!L.loading){L.setLoading(!0),o.drzVideoPlayer.destroy(o,"play"),delete t.videoPlayer[r],window.localStorage.setItem("drzzleStorage",JSON.stringify(t));var d=e(n.target).closest("[data-video-src]").attr("data-video-src");a.attr("src",d);var s=document.createElement("video");s.src=d,L.isIOS()&&(s.autoplay=!0),s.onloadeddata=function(){s.pause(),s.remove(),o.drzVideoPlayer(),L.setLoading(!1),L.showPlaying(),L.isIOS()||(i.trigger("click"),L.togglePlay())}}},buildEpisodes:function(){var n=JSON.parse(d).list,r=o.next(".drzVideo-episodes-container");if(r.length)L.$listContainer=r;else{var i=e('<div class="drzVideo-episodes-container"></div>');n.forEach(function(n){var r=e('<a class="drzVideo-episodes-item" data-video-src="'+n.source+'" href="#">\n                  <div class="drzVideo-episodes-data">\n                    <span class="drzVideo-episodes-title">'+n.title+'</span>\n                    <span class="drzVideo-episodes-date">Published - '+n.published+'</span>\n                  </div>\n                  <div class="drzVideo-episodes-rcol">\n                    <span class="drzVideo-episode-playing"></span>\n                    <span class="drzVideo-episodes-plbtn"></span>\n                  </div>\n                </a>');r.click(L.onClickTrack),i.append(r),i.insertAfter(o)}),L.$listContainer=i}},isIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)},iosChecks:function(){L.isIOS()&&(p.hide(),E.hide())},$errorEl:null,addErrorMessage:function(){var o=b.find(".drzVideo-error-message");if(o.length)L.$errorEl=o;else{var n=e('<div class="drzVideo-error-message"></div>');b.append(n),L.$errorEl=n}}};L.isIOS()&&s.attr("playsinline",!0),L.addErrorMessage(),v.find(".drzVideo-playBtn-inner").addClass("drzVideo-play-icon");var F=t.videoPlayer[r];if(F){if(!d&&F.source===k){L.setLoading(!0);var B=document.createElement("video");B.src=k,L.isIOS()&&(B.autoplay=!0),B.onloadeddata=function(){B.pause(),B.remove(),l.currentTime=F.seconds,L.setLoading(!1)}}if(d)if(JSON.parse(d).list.map(function(e){return e.source}).includes(F.source)){L.setLoading(!0),a.attr("src",F.source);var M=document.createElement("video");M.src=F.source,L.isIOS()&&(M.autoplay=!0),M.onloadeddata=function(){M.pause(),M.remove(),l.currentTime=F.seconds,L.setLoading(!1)}}}else t.videoPlayer[r]={source:null,seconds:0};L.iosChecks(),l.addEventListener("progress",L.onBuffer),i.one("click",L.toggleControls),L.bindFullScreenEvents(),L.buildToolTips(),n.on("vmousedown",L.onMouseDown),n.on("vmouseup",L.onMouseUp),n.on("vmousemove",L.onMouseMove),S.click(function(e){return e.stopPropagation()}),E.click(function(e){return e.stopPropagation()}),b.click(L.togglePlay),l.addEventListener("durationchange",L.getTotalTime,!1),l.addEventListener("timeupdate",L.onTimeUpdate,!1),l.addEventListener("ended",L.onEnded,!1),l.addEventListener("play",L.onPlay,!1),l.addEventListener("pause",L.onPause,!1),V.on("vmousemove",L.onProgressHover),V.on("vmouseout",L.onProgressLeave),V.on("vmousedown",L.setProgress),f.on("vmouseover",L.onButtonHover),f.on("vmouseout",L.onButtoneLeave),document.addEventListener("keydown",L.onKeydown),v.on("click",L.togglePlay),m.change(L.setVolume),m.on("vmouseup",L.volMouseUp),p.click(L.toggleMute),y.click(L.toggleFullScreen),L.setVolumeIcon(),d&&(L.buildEpisodes(),L.showPlaying()),e.fn.drzVideoPlayer.destroy=function(e,o){e.off("click"),e.off("mouseleave"),e.off("vmousemove"),e.find(".drzVideo-videoTime").off("click"),e.find(".drzVideo-volSliderContainer").off("click"),e.find(".drzVideo-overlay").off("click"),e.find(".drzVideo-progressBar").off("vmousedown",L.setProgress),e.find(".drzVideo-progressBar").off("vmousemove",L.onProgressHover),e.find(".drzVideo-progressBar").off("vmouseout",L.onProgressLeave),e.find(".drzVideo-controls button").on("vmouseover",L.onButtonHover),e.find(".drzVideo-playBtn-inner").off("click").removeClass("drzVideo-pause-icon drzVideo-play-icon"),e.find(".drzVideo-volSlider").off("change"),e.find(".drzVideo-volSlider").off("vmouseup",L.volMouseUp),e.find(".drzVideo-volBtn-inner").off("click"),e.find(".drzVideo-fullScreenBtn-inner").off("click"),document.removeEventListener("keydown",L.onKeydown),n.off("vmousedown",L.onMouseDown),n.off("vmouseup",L.onMouseUp),n.off("vmousemove",L.onMouseMove);var r=e.find(".drzVideo-src").get(0);r.removeEventListener("loadeddata",L.onVideoLoad),r.removeEventListener("progress",L.onBuffer),r.removeEventListener("durationchange",L.getTotalTime,!1),r.removeEventListener("timeupdate",L.onTimeUpdate,!1),r.removeEventListener("ended",L.onEnded,!1),r.removeEventListener("play",L.onPlay,!1),r.removeEventListener("pause",L.onPause,!1);var d=e.find(".drzVideo-controlBar");d.off("vmouseover"),d.off("mouseleave"),L.destroyFullScreenEvents(),window.__editor&&!o&&e.next(".drzVideo-episodes-container").remove()}}),this}}(jQuery);