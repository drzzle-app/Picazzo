"use strict";!function(e){e.fn.drzVideoPlayer=function(){var o=e(this),n=e(document),d=o.attr("data-player-id"),r=o.attr("data-episodes"),i=window.localStorage.getItem("drzzleStorage"),t=i?JSON.parse(i):{};return t.videoPlayer=t.videoPlayer||{},o.each(function(){var i=e(this),s=i.find(".drzVideo-src"),l=s.get(0),a=s.find("source"),u=i.get(0),c=i.find(".drzVideo-controls"),f=c.find("button"),v=i.find(".drzVideo-playBtn"),m=i.find(".drzVideo-volSlider"),p=i.find(".drzVideo-volBtn"),g=p.find(".drzVideo-btn-tooltip"),z=i.find(".drzVideo-progress"),V=i.find(".drzVideo-progressBar"),h=i.find(".drzVideo-buffer"),C=i.find(".drzVideo-timeline-tooltip"),y=i.find(".drzVideo-fullScreenBtn"),w=i.find(".drzVideo-currentTime"),P=i.find(".drzVideo-totalTime"),b=i.find(".drzVideo-videoTime"),E=i.find(".drzVideo-volSliderContainer"),k=i.find(".drzVideo-overlay"),S=k.find(".drzVideo-playBtn-lrg"),T=a.attr("src");w.html("0:00"),i.find(".drzVideo-src").load();var L={onVideoLoad:function(){L.setLoading(!1)},loading:!1,setLoading:function(e){L.loading=e,e?(k.addClass("drzVideo-loading"),S.hide()):(k.removeClass("drzVideo-loading"),S.show())},getTotalTime:function(){var e=parseInt(l.duration/60,10),o=parseInt(l.duration%60,10),n=parseInt(e/60,10);o=o<10?":0"+o:":"+o,n>0?n+=":":n="",P.html(n+e+o);var d=i.parent();d.hasClass("drzVideo-feature")&&(d.find(".drzVideo-featureDuration").html("0:00"),d.find(".drzVideo-featureTotalTime").html(n+e+o))},onTimeUpdate:function(){var e=parseInt(l.currentTime/60,10),o=parseInt(l.currentTime%60,10),n=parseInt(e/60,10),r=parseInt(l.currentTime.toFixed(0),10),s=parseInt(t.videoPlayer[d].seconds,10);0!==r&&r!==s&&(t.videoPlayer[d].seconds=r,window.localStorage.setItem("drzzleStorage",JSON.stringify(t)));var a=0;l.currentTime>0&&(a=Math.floor(100/l.duration*l.currentTime)),o=o<10?":0"+o:":"+o,n>0?n+=":":n="",z.css("width",a+"%"),w.html(n+e+o);var u=i.parent();u.hasClass("drzVideo-feature")&&u.find(".drzVideo-featureDuration").html(n+e+o)},onEnded:function(){if(k.css("opacity",1),S.is(":visible")||S.show(),S.addClass("drzVideo-replayBtn"),v.find(".drzVideo-playBtn-inner").removeClass("drzVideo-play-icon drzVideo-pause-icon").addClass("drzVideo-replayBtn"),v.find(".drzVideo-btn-tooltip").text("Replay (p)"),r){var e=a.attr("src");L.$listContainer.find('[data-video-src="'+e+'"]').find(".drzVideo-episodes-rcol").removeClass("drzVideo-playing")}},updateProgress:function(e){var o=l.duration,n=(e-V.offset().left)/V.width()*100;n>100&&(n=100),n<0&&(n=0),l.currentTime=o*(n/100),z.css("width",n+"%")},displayTime:function(e){var o=~~(e/3600),n=~~(e%3600/60),d=~~e%60,r="";return o>0&&(r+=o+":"+(n<10?"0":"")),r+=n+":"+(d<10?"0":""),r+=""+d},progressDrag:!1,onProgressHover:function(e){C.show();var o=l.duration,n=e.pageX-V.offset().left,d=n/V.width()*100;d>100&&(d=100),d<0&&(d=0);var r=V.width(),i=Math.round(o*(d/100)),t=L.displayTime(i);C.text(t);var s=C.outerWidth()/2;if(n>=0&&n<=r){C.css("left",n-s+"px");var a=L.posCheck(V,C);a.bleeding&&C.css("left",n-s-a.diff+"px")}},posCheck:function(e,o){var n=e.get(0).getBoundingClientRect(),d=o.get(0).getBoundingClientRect(),r=d.left<=n.left,i=d.right>=n.right,t=r||i,s=void 0,l=0;return r&&(l=d.left-n.left,s="left"),i&&(l=d.right-n.right,s="right"),{bleeding:t,diff:l,bleedDir:s}},onProgressLeave:function(){C.hide()},setProgress:function(e){L.progressDrag=!0,L.updateProgress(e.pageX)},onMouseUp:function(e){n.find("body").removeClass("drz-mousedown"),L.progressDrag&&(L.progressDrag=!1,L.updateProgress(e.pageX))},onMouseDown:function(){n.find("body").addClass("drz-mousedown")},onMouseMove:function(e){L.progressDrag&&L.updateProgress(e.pageX)},hideControls:null,slideControlsUp:function(){c.hasClass("drzVide-slideDown")&&(c.removeClass("drzVide-slideDown"),z.removeClass("drzVideo-soloProgress"),V.removeClass("drzVideo-soloProgress"),clearTimeout(L.hideControls),L.hideControls=setTimeout(function(){c.hasClass("drzVide-slideDown")||(c.addClass("drzVide-slideDown"),z.addClass("drzVideo-soloProgress"),V.addClass("drzVideo-soloProgress"))},3e3))},clearTime:function(){return clearTimeout(L.hideControls)},slideControlsDown:function(){clearTimeout(L.hideControls),L.hideControls=setTimeout(function(){c.hasClass("drzVide-slideDown")||(c.addClass("drzVide-slideDown"),z.addClass("drzVideo-soloProgress"),V.addClass("drzVideo-soloProgress"))},3e3)},offHover:function(){clearTimeout(L.hideControls),c.hasClass("drzVide-slideDown")||(c.addClass("drzVide-slideDown"),z.addClass("drzVideo-soloProgress"),V.addClass("drzVideo-soloProgress"))},toggleControls:function(){i.on("vmousemove",L.slideControlsUp),i.find(".drzVideo-controlBar").on("vmouseover",L.clearTime),i.find(".drzVideo-controlBar").on("mouseleave",L.slideControlsDown),i.mouseleave(L.offHover),L.slideControlsDown()},onPlay:function(){k.css("opacity",0),S.removeClass("drzVideo-replayBtn"),S.is(":visible")&&S.hide(),v.find(".drzVideo-playBtn-inner").removeClass("drzVideo-play-icon drzVideo-replayBtn").addClass("drzVideo-pause-icon"),v.find(".drzVideo-btn-tooltip").text("Pause (p)");var e=s.find("source").attr("src");(t.videoPlayer[d].source=e,r)&&L.$listContainer.find(".drzVideo-episodes-livebtn").parent().addClass("drzVideo-playing")},onPause:function(){if(v.find(".drzVideo-playBtn-inner").removeClass("drzVideo-pause-icon drzVideo-replayBtn").addClass("drzVideo-play-icon"),k.css("opacity",1),S.is(":visible")||S.show(),v.find(".drzVideo-btn-tooltip").text("Play (p)"),window.matchMedia(drzzle.viewports.mobile).matches&&L.slideControlsUp(),r){var e=a.attr("src");L.$listContainer.find('[data-video-src="'+e+'"]').find(".drzVideo-episodes-rcol").removeClass("drzVideo-playing")}},togglePlay:function(e){L.loading||(v.find(".drzVideo-playBtn-inner").hasClass("drzVideo-play-icon")||v.find(".drzVideo-playBtn-inner").hasClass("drzVideo-replayBtn")?L.playVideo(e):L.pauseVideo(e))},playVideo:function(){(l.paused||l.ended)&&l.play()},pauseVideo:function(){l.pause()},setVolume:function(e){var o=m.val();l.volume=o,0===o&&L.toggleMute(e,!0),L.setVolumeIcon()},volMouseUp:function(){m.blur()},setVolumeIcon:function(){var e=p.find(".drzVideo-volBtn-inner"),o=~~m.attr("max"),n=(m.val()/o*100).toFixed(0);e.removeClass("drzVideo-vol-mute drzVideo-vol-min drzVideo-vol-med drzVideo-vol-max");var d="";0==~~n?(d="drzVideo-vol-mute",g.text("Unmute (m)")):g.text("Mute (m)"),n>0&&n<=30&&(d="drzVideo-vol-min"),n>30&&n<=70&&(d="drzVideo-vol-med"),n>70&&n<=100&&(d="drzVideo-vol-max"),e.addClass(d)},lastVolume:null,isMuted:!1,toggleMute:function(e,o){e&&e.stopPropagation(),L.isMuted?(l.volume=L.lastVolume,m.val(L.lastVolume),g.text("Mute (m)"),L.isMuted=!1):(L.lastVolume=m.val(),l.volume=0,m.val(0),g.text("Unmute (m)"),L.isMuted=!0),o||L.setVolumeIcon()},onButtonHover:function(o){var n=e(o.target).parent().prev(".drzVideo-btn-tooltip");if(n.length>0){var d=L.posCheck(V,n);d.bleeding&&n.css({left:50-d.diff+"%",transform:"translateX("+(-50-d.diff)+"%)"})}},onButtoneLeave:function(o){var n=e(o.target).parent().prev(".drzVideo-btn-tooltip");n.length>0&&n.css({left:"",transform:""})},toggleFullScreen:function(e){e&&e.stopPropagation(),void 0!==document.fullScreenElement&&null===document.fullScreenElement||void 0!==document.msFullscreenElement&&null===document.msFullscreenElement||void 0!==document.mozFullScreen&&!document.mozFullScreen||void 0!==document.webkitIsFullScreen&&!document.webkitIsFullScreen?u.requestFullScreen?u.requestFullScreen():u.mozRequestFullScreen?u.mozRequestFullScreen():u.webkitRequestFullScreen?u.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):u.msRequestFullscreen&&u.msRequestFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},fastForward:function(e){l.currentTime+=e},rewind:function(e){l.currentTime-=e},onKeydown:function(e){var o=e.key||e.which;"p"===o&&L.togglePlay(),"m"===o&&L.toggleMute(),"f"===o&&L.toggleFullScreen(),"ArrowRight"===o&&L.fastForward(5),"ArrowLeft"===o&&L.rewind(5)},fullscreenChecks:function(){var e=y.find(".drzVideo-btn-tooltip"),o=document.fullscreenElement,n=document.msFullscreenElement,d=document.mozFullScreen,r=document.webkitIsFullScreen;o||n||d||r?e.text("Exit full screen (f)"):e.text("Full screen (f)")},bindFullScreenEvents:function(){document.addEventListener("fullscreenchange",L.fullscreenChecks),document.addEventListener("mozfullscreenchange",L.fullscreenChecks),document.addEventListener("webkitfullscreenchange",L.fullscreenChecks),document.addEventListener("msfullscreenchange",L.fullscreenChecks)},destroyFullScreenEvents:function(){document.removeEventListener("fullscreenchange",L.fullscreenChecks),document.removeEventListener("mozfullscreenchange",L.fullscreenChecks),document.removeEventListener("webkitfullscreenchange",L.fullscreenChecks),document.removeEventListener("msfullscreenchange",L.fullscreenChecks)},buildToolTips:function(){v.find(".drzVideo-btn-tooltip").text("Play (p)"),p.find(".drzVideo-btn-tooltip").text("Mute (m)"),y.find(".drzVideo-btn-tooltip").text("Full screen (f)")},onBuffer:function(){var e=l.duration;if(e>0)for(var o=0;o<l.buffered.length;o++)if(l.buffered.start(l.buffered.length-1-o)<l.currentTime){var n=l.buffered.end(l.buffered.length-1-o)/e*100;h.css({width:Math.floor(n)+"%"});break}},$listContainer:null,showPlaying:function(){var o=a.attr("src");L.$listContainer.find("[data-video-src]").each(function(){var n=e(this);n.find(".drzVideo-episodes-rcol").removeClass("drzVideo-playing");var d=n.find(".drzVideo-episodes-plbtn");n.attr("data-video-src")===o?d.addClass("drzVideo-episodes-livebtn"):d.removeClass("drzVideo-episodes-livebtn")})},onClickTrack:function(n){if(n.preventDefault(),!L.loading){L.setLoading(!0),o.drzVideoPlayer.destroy(o,"play"),delete t.videoPlayer[d],window.localStorage.setItem("drzzleStorage",JSON.stringify(t));var r=e(n.target).closest("[data-video-src]").attr("data-video-src");a.attr("src",r);var s=document.createElement("video");s.src=r,s.onloadeddata=function(){o.drzVideoPlayer(),L.setLoading(!1),L.showPlaying(),i.trigger("click"),L.togglePlay(),s.remove()}}},buildEpisodes:function(){var n=JSON.parse(r).list,d=o.next(".drzVideo-episodes-container");if(d.length)L.$listContainer=d;else{var i=e('<div class="drzVideo-episodes-container"></div>');n.forEach(function(n){var d=e('<a class="drzVideo-episodes-item" data-video-src="'+n.source+'" href="#">\n                  <div class="drzVideo-episodes-data">\n                    <span class="drzVideo-episodes-title">'+n.title+'</span>\n                    <span class="drzVideo-episodes-date">Published - '+n.published+'</span>\n                  </div>\n                  <div class="drzVideo-episodes-rcol">\n                    <span class="drzVideo-episode-playing"></span>\n                    <span class="drzVideo-episodes-plbtn"></span>\n                  </div>\n                </a>');d.click(L.onClickTrack),i.append(d),i.insertAfter(o)}),L.$listContainer=i}}};v.find(".drzVideo-playBtn-inner").addClass("drzVideo-play-icon");var B=t.videoPlayer[d];if(B){if(!r&&B.source===T){L.setLoading(!0);var F=document.createElement("video");F.src=T,F.onloadeddata=function(){l.currentTime=B.seconds,L.setLoading(!1),F.remove()}}if(r)if(JSON.parse(r).list.map(function(e){return e.source}).includes(B.source)){L.setLoading(!0),a.attr("src",B.source);var M=document.createElement("video");M.src=B.source,M.onloadeddata=function(){l.currentTime=B.seconds,L.setLoading(!1),M.remove()}}}else t.videoPlayer[d]={source:null,seconds:0};l.addEventListener("progress",L.onBuffer),i.one("click",L.toggleControls),L.bindFullScreenEvents(),L.buildToolTips(),n.on("vmousedown",L.onMouseDown),n.on("vmouseup",L.onMouseUp),n.on("vmousemove",L.onMouseMove),b.click(function(e){return e.stopPropagation()}),E.click(function(e){return e.stopPropagation()}),k.click(L.togglePlay),l.addEventListener("durationchange",L.getTotalTime,!1),l.addEventListener("timeupdate",L.onTimeUpdate,!1),l.addEventListener("ended",L.onEnded,!1),l.addEventListener("play",L.onPlay,!1),l.addEventListener("pause",L.onPause,!1),V.on("vmousemove",L.onProgressHover),V.on("vmouseout",L.onProgressLeave),V.on("vmousedown",L.setProgress),f.on("vmouseover",L.onButtonHover),f.on("vmouseout",L.onButtoneLeave),document.addEventListener("keydown",L.onKeydown),v.click(L.togglePlay),m.change(L.setVolume),m.on("vmouseup",L.volMouseUp),p.click(L.toggleMute),y.click(L.toggleFullScreen),L.setVolumeIcon(),r&&(L.buildEpisodes(),L.showPlaying()),e.fn.drzVideoPlayer.destroy=function(e,o){e.off("click"),e.off("mouseleave"),e.off("vmousemove"),e.find(".drzVideo-videoTime").off("click"),e.find(".drzVideo-volSliderContainer").off("click"),e.find(".drzVideo-overlay").off("click"),e.find(".drzVideo-progressBar").off("vmousedown",L.setProgress),e.find(".drzVideo-progressBar").off("vmousemove",L.onProgressHover),e.find(".drzVideo-progressBar").off("vmouseout",L.onProgressLeave),e.find(".drzVideo-controls button").on("vmouseover",L.onButtonHover),e.find(".drzVideo-playBtn-inner").off("click").removeClass("drzVideo-pause-icon drzVideo-play-icon"),e.find(".drzVideo-volSlider").off("change"),e.find(".drzVideo-volSlider").off("vmouseup",L.volMouseUp),e.find(".drzVideo-volBtn-inner").off("click"),e.find(".drzVideo-fullScreenBtn-inner").off("click"),document.removeEventListener("keydown",L.onKeydown),n.off("vmousedown",L.onMouseDown),n.off("vmouseup",L.onMouseUp),n.off("vmousemove",L.onMouseMove);var d=e.find(".drzVideo-src").get(0);d.removeEventListener("loadeddata",L.onVideoLoad),d.removeEventListener("progress",L.onBuffer),d.removeEventListener("durationchange",L.getTotalTime,!1),d.removeEventListener("timeupdate",L.onTimeUpdate,!1),d.removeEventListener("ended",L.onEnded,!1),d.removeEventListener("play",L.onPlay,!1),d.removeEventListener("pause",L.onPause,!1);var r=e.find(".drzVideo-controlBar");r.off("vmouseover"),r.off("mouseleave"),L.destroyFullScreenEvents(),window.__editor&&!o&&e.next(".drzVideo-episodes-container").remove()}}),this}}(jQuery);